<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <title>VTSæ¨¡å‹æ”¹è‰²åŠ©æ‰‹</title>
        <style>
            body {
                font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                max-width: 760px;
                margin: 40px auto;
                padding: 0 16px 40px;
                line-height: 1.6;
            }
            h1 {
                font-size: 26px;
                margin-bottom: 12px;
            }
            label {
                display: block;
                margin-top: 16px;
                font-weight: 600;
            }
            input[type='text'] {
                width: 120px;
                padding: 4px 6px;
                font-size: 14px;
                margin-right: 8px;
            }
            input[type='color'] {
                width: 40px;
                height: 28px;
                padding: 0;
                border: none;
                margin-left: 8px;
                cursor: pointer;
            }
            button {
                margin-top: 20px;
                padding: 6px 16px;
                font-size: 14px;
            }
            .row {
                display: flex;
                align-items: center;
                margin-top: 8px;
                flex-wrap: wrap;
            }
            .swatch {
                width: 40px;
                height: 20px;
                border-radius: 4px;
                border: 1px solid #ccc;
                margin-left: 8px;
            }
            .result-block {
                margin-top: 24px;
                padding: 12px;
                border-radius: 8px;
                border: 1px solid #ddd;
                background: #fafafa;
            }
            .mono {
                font-family: SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
            }
            small {
                color: #666;
            }

            /* è‰²å¡ */
            .palette {
                margin-top: 12px;
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }
            .color-box {
                width: 32px;
                height: 32px;
                border-radius: 4px;
                cursor: pointer;
                border: 1px solid #ccc;
            }

            .color-picker-label {
                margin-left: 8px;
                font-size: 13px;
                color: #555;
            }

			.hiden {
				display: none;
			}

            input[type='color'] {
                width: 40px;
                height: 28px;
                padding: 0;
                border: 2px solid #888;
                border-radius: 4px;
                cursor: pointer;
                transition: 0.2s;
            }

            input[type='color']:hover {
                border-color: #000;
                transform: scale(1.05);
            }
        </style>
    </head>
    <body>
        <h1>VTSæ¨¡å‹æ”¹è‰²åŠ©æ‰‹</h1>
        <p>
            è¾“å…¥æˆ–é€‰æ‹©åŸå§‹é¢œè‰²ä¸ç›®æ ‡é¢œè‰²ï¼Œæœ¬å·¥å…·ä¼šè®¡ç®—ï¼š ä¸ºäº†åœ¨å°½é‡ä½¿ç”¨å åº•çš„åŒæ—¶ï¼Œè®©æ»¤è‰²é¢œè‰²äº®åº¦å°½å¯èƒ½ä½çš„ä¸€ç»„
            <span class="mono">Multiply</span> å’Œ <span class="mono">Screen</span> é¢œè‰²ã€‚
        </p>
		<label>
			åŸå§‹é¢œè‰²ï¼ˆBaseï¼‰
			<small>ä¾‹å¦‚ï¼ša99595</small>
		  </label>
		<div class="row">

			<input type="text" id="baseColor" value="a99595" maxlength="6" />
			<input type="color" id="basePicker" title="ç‚¹å‡»è¿™é‡Œé€‰æ‹©é¢œè‰²" />
			<span class="color-picker-label">ğŸ¨ ç‚¹å‡»å·¦ä¾§è‰²å—é€‰æ‹©é¢œè‰²</span>
			<div id="baseSwatch" class="swatch hiden"></div>
		  </div>
		  <label>
			ç›®æ ‡é¢œè‰²ï¼ˆTargetï¼‰
			<small>ä¾‹å¦‚ï¼šffb3a7</small>
		  </label>
		  <div class="row">

			<input type="text" id="targetColor" value="ffb3a7" maxlength="6" />
			<input type="color" id="targetPicker" title="ç‚¹å‡»è¿™é‡Œé€‰æ‹©é¢œè‰²" />
			<span class="color-picker-label">ğŸ¨ ç‚¹å‡»å·¦ä¾§è‰²å—é€‰æ‹©é¢œè‰²</span>
			<div id="targetSwatch" class="swatch hiden"></div>
		  </div>
		  

        <!-- è‰²å¡ -->
        <label>å¸¸ç”¨è‰²å¡ï¼ˆç‚¹å‡»å¯å¿«é€Ÿé€‰æ‹©ç›®æ ‡é¢œè‰²ï¼‰</label>
        <div class="palette" id="palette"></div>

        <button id="calcBtn">è®¡ç®—</button>

        <div id="results" class="result-block" style="display: none">
            <h2>è®¡ç®—ç»“æœ</h2>

            <div class="row">
                <span>æ¨èå åº•é¢œè‰²ï¼ˆMultiplyï¼‰ï¼š</span>
                <span class="mono" id="multiplyHex" style="margin-left: 8px"></span>
                <div id="multiplySwatch" class="swatch"></div>
            </div>

            <div class="row">
                <span>æ¨èæ»¤è‰²é¢œè‰²ï¼ˆScreenï¼‰ï¼š</span>
                <span class="mono" id="screenHex" style="margin-left: 8px"></span>
                <div id="screenSwatch" class="swatch"></div>
            </div>

            <hr style="margin: 16px 0" />

            <div class="row">
                <span>å åº•åçš„ä¸­é—´ç»“æœï¼š</span>
                <span class="mono" id="afterMultiplyHex" style="margin-left: 8px"></span>
                <div id="afterMultiplySwatch" class="swatch"></div>
            </div>

            <div class="row">
                <span>å åº• + æ»¤è‰² åçš„è®¡ç®—ç»“æœï¼š</span>
                <span class="mono" id="finalColorHex" style="margin-left: 8px"></span>
                <div id="finalColorSwatch" class="swatch"></div>
            </div>

            <p style="margin-top: 12px">
                <small> æ³¨æ„ï¼šå› ä¸ºå­˜åœ¨å››èˆäº”å…¥ï¼Œæœ€ç»ˆç»“æœå¯èƒ½ä¸ç›®æ ‡é¢œè‰²çš„æŸäº›é€šé“ç›¸å·® 1ã€‚ </small>
            </p>
            <p id="warning" style="color: #c00; margin-top: 4px; display: none"></p>
        </div>

        <script>
            /* ---------- å·¥å…·å‡½æ•° ---------- */
            function clamp255(v) {
                return Math.min(255, Math.max(0, Math.round(v)));
            }
            function hexToRgb(hex) {
                hex = hex.trim().replace(/^#/, '');
                return {
                    r: parseInt(hex.slice(0, 2), 16),
                    g: parseInt(hex.slice(2, 4), 16),
                    b: parseInt(hex.slice(4, 6), 16),
                };
            }
            function rgbToHex(r, g, b) {
                const to2 = (v) => v.toString(16).padStart(2, '0').toUpperCase();
                return to2(r) + to2(g) + to2(b);
            }

            /* ---------- æ±‚è§£å•é€šé“ ---------- */
            function solveChannel(b, t) {
                if (b === 0) return { m: 255, s: t };
                if (t <= b) {
                    return { m: clamp255(255 * (t / b)), s: 0 };
                }
                const B = b / 255,
                    T = t / 255;
                const S = 1 - (1 - T) / (1 - B);
                return { m: 255, s: clamp255(S * 255) };
            }

            /* ---------- æ··åˆ ---------- */
            function applyMultiplyOnly(base, mul) {
                return {
                    r: clamp255((base.r * mul.r) / 255),
                    g: clamp255((base.g * mul.g) / 255),
                    b: clamp255((base.b * mul.b) / 255),
                };
            }
            function applyMultiplyScreen(base, mul, scr) {
                function blend(b, m, s) {
                    const B = b / 255,
                        M = m / 255,
                        S = s / 255;
                    const U = B * M;
                    return clamp255((1 - (1 - U) * (1 - S)) * 255);
                }
                return {
                    r: blend(base.r, mul.r, scr.r),
                    g: blend(base.g, mul.g, scr.g),
                    b: blend(base.b, mul.b, scr.b),
                };
            }

            /* ---------- è‰²å¡ ---------- */
            const paletteColors = [
                // --- ç²‰è‰²ç³» ---
                'FFB3A7',
                'FF9AA2',
                'FFB7B2',
                'FFDAC1',
                'F7C5CC',
                'F4A7B9',
                'E799B0',
                'E36AA5',
                // --- çº¢è‰²ç³» ---
                'FF6F6F',
                'FF8A80',
                'FF5252',
                'E53935',
                'D32F2F',
                'C62828',
                // --- æ©™è‰²ç³» ---
                'FFAB40',
                'FF8F00',
                'FF7043',
                'F57C00',
                'EF6C00',
                'E65100',
                // --- é»„è‰²ç³» ---
                'FFD740',
                'FFF59D',
                'FFEB3B',
                'FBC02D',
                'F9A825',
                'F57F17',
                // --- ç»¿è‰²ç³» ---
                'C5E1A5',
                'A5D6A7',
                '81C784',
                '66BB6A',
                '4CAF50',
                '43A047',
                '2E7D32',
                // --- é’è‰²ç³» ---
                'A7FFEB',
                '64FFDA',
                '1DE9B6',
                '00BFA5',
                '26A69A',
                '00897B',
                // --- è“è‰²ç³» ---
                'A7C7E7',
                '89CFF0',
                '6EC6FF',
                '5AB9EA',
                '4D96FF',
                '2196F3',
                '1976D2',
                '0D47A1',
                // --- ç´«è‰²ç³» ---
                'B39DDB',
                '9575CD',
                '7E57C2',
                '673AB7',
                '5E35B1',
                '512DA8',
                // --- æ£•è‰²ç³»ï¼ˆå‘è‰²å¸¸ç”¨ï¼‰ ---
                '4E342E',
                '5D4037',
                '6D4C41',
                '795548',
                '8D6E63',
                'A1887F',
                'D7CCC8',
                // --- ç°è‰²ç³»ï¼ˆè¡£æœ/é˜´å½±å¸¸ç”¨ï¼‰ ---
                'FAFAFA',
                'F5F5F5',
                'EEEEEE',
                'E0E0E0',
                'BDBDBD',
                '9E9E9E',
                '757575',
                '616161',
                '424242',
                '212121',
                // --- è‚¤è‰²ï¼ˆLive2D å¸¸ç”¨ï¼‰ ---
                'FFE0BD',
                'FFCD94',
                'EAC086',
                'D1A374',
                'C68642',
                '8D5524',
                // --- äº®è‰²ç³» ---
                'FFEE58',
                'FFCA28',
                'FFA726',
                'FF7043',
                'FF8A65',
                'F06292',
                // --- æš—è‰²ç³» ---
                '263238',
                '37474F',
                '455A64',
                '546E7A',
                '607D8B',
                // --- ä¸»é¢˜è‰²ï¼ˆæŸ”å’Œï¼‰ ---
                'F8EDEB',
                'FCD5CE',
                'F8D7DA',
                'E8E8E4',
                'D8E2DC',
                'ECE4DB',
                'FFE5D9',
                'FFD7BA',
                'FEC89A',
                // --- ä¸»é¢˜è‰²ï¼ˆäº®è‰²ï¼‰ ---
                'FF6F91',
                'FF9671',
                'FFC75F',
                'F9F871',
                'A1E44D',
                '4DD599',
                '4DB6AC',
                '4D96FF',
            ];

            function initPalette() {
                const box = document.getElementById('palette');
                paletteColors.forEach((hex) => {
                    const div = document.createElement('div');
                    div.className = 'color-box';
                    div.style.backgroundColor = '#' + hex;
                    div.onclick = () => {
                        document.getElementById('targetColor').value = hex;
                        document.getElementById('targetPicker').value = '#' + hex;
                        updateSwatch('targetSwatch', hex);
                    };
                    box.appendChild(div);
                });
            }

            /* ---------- UI æ›´æ–° ---------- */
            function updateSwatch(id, hex) {
                document.getElementById(id).style.backgroundColor = '#' + hex;
            }

            /* ---------- ä¸»é€»è¾‘ ---------- */
            function main() {
                initPalette();

                const baseInput = document.getElementById('baseColor');
                const targetInput = document.getElementById('targetColor');
                const basePicker = document.getElementById('basePicker');
                const targetPicker = document.getElementById('targetPicker');

                function syncPickerFromText() {
                    try {
                        basePicker.value = '#' + baseInput.value;
                        targetPicker.value = '#' + targetInput.value;
                        updateSwatch('baseSwatch', baseInput.value);
                        updateSwatch('targetSwatch', targetInput.value);
                    } catch {}
                }
                function syncTextFromPicker() {
                    baseInput.value = basePicker.value.replace('#', '');
                    targetInput.value = targetPicker.value.replace('#', '');
                    syncPickerFromText();
                }

                baseInput.oninput = syncPickerFromText;
                targetInput.oninput = syncPickerFromText;
                basePicker.oninput = syncTextFromPicker;
                targetPicker.oninput = syncTextFromPicker;

                syncPickerFromText();

                document.getElementById('calcBtn').onclick = () => {
                    const base = hexToRgb(baseInput.value);
                    const target = hexToRgb(targetInput.value);

                    const r = solveChannel(base.r, target.r);
                    const g = solveChannel(base.g, target.g);
                    const b = solveChannel(base.b, target.b);

                    const mul = { r: r.m, g: g.m, b: b.m };
                    const scr = { r: r.s, g: g.s, b: b.s };

                    const mulHex = rgbToHex(mul.r, mul.g, mul.b);
                    const scrHex = rgbToHex(scr.r, scr.g, scr.b);

                    document.getElementById('multiplyHex').textContent = '#' + mulHex;
                    document.getElementById('screenHex').textContent = '#' + scrHex;
                    updateSwatch('multiplySwatch', mulHex);
                    updateSwatch('screenSwatch', scrHex);

                    const afterMul = applyMultiplyOnly(base, mul);
                    const afterMulHex = rgbToHex(afterMul.r, afterMul.g, afterMul.b);
                    document.getElementById('afterMultiplyHex').textContent = '#' + afterMulHex;
                    updateSwatch('afterMultiplySwatch', afterMulHex);

                    const final = applyMultiplyScreen(base, mul, scr);
                    const finalHex = rgbToHex(final.r, final.g, final.b);
                    document.getElementById('finalColorHex').textContent = '#' + finalHex;
                    updateSwatch('finalColorSwatch', finalHex);

                    document.getElementById('results').style.display = 'block';
                };
            }

            main();
        </script>
    </body>
</html>
